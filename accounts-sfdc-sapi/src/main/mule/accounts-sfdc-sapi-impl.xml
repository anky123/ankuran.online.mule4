<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<sub-flow name="create-account" doc:id="a2e406fe-32b1-4597-a6b0-1f294cb44b23" >
		<ee:transform doc:name="Prepare reqest payload" doc:id="bc9ab37d-e915-445c-a6a3-551c5fbb576a" >
			<ee:message >
				<ee:set-payload resource="dwl/createAccountRequest.dwl"/>
			</ee:message>
		</ee:transform>
		<until-successful maxRetries="${secure::until_successful.max_retries}" millisBetweenRetries="${secure::until_successful.millis_between_retries}" doc:name="Until Successful" doc:id="08ca567d-783a-4df6-8973-d0be99e48aa8" >
			<salesforce:create doc:name="Create Account" doc:id="37ed697b-edfb-46cc-bf85-b605f9f2aaed" config-ref="Salesforce_Config" type="Account" target="responseData" targetValue="#[payload]"/>
		</until-successful>
		<logger level="DEBUG" doc:name="DEBUG : create account response" doc:id="db6d4530-7bea-4386-aed9-dd69022fe115" message='#[payload]'/>
		<ee:transform doc:name="Prepare response payload" doc:id="72b9f60a-8a74-4eb9-9b8e-81ae265c5a0b" >
			<ee:message >
				<ee:set-payload resource="dwl/createAccountResponse.dwl"/>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[201]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>
	<sub-flow name="update-account" doc:id="a2e406fe-32b1-4597-a6b0-1f294cb44b23" >
		<ee:transform doc:name="Prepare reqest payload" doc:id="bc9ab37d-e915-445c-a6a3-551c5fbb576a" >
			<ee:message >
				<ee:set-payload resource="dwl/updateAccountRequest.dwl"/>
			</ee:message>
		</ee:transform>
		<until-successful maxRetries="${secure::until_successful.max_retries}" millisBetweenRetries="${secure::until_successful.millis_between_retries}" doc:name="Until Successful" doc:id="08ca567d-783a-4df6-8973-d0be99e48aa8" >
			<salesforce:update doc:name="Update Account" doc:id="37ed697b-edfb-46cc-bf85-b605f9f2aaed" config-ref="Salesforce_Config" type="Account" target="responseData" targetValue="#[payload]"/>
		</until-successful>
		<logger level="DEBUG" doc:name="DEBUG : update account response" doc:id="db6d4530-7bea-4386-aed9-dd69022fe115" message='#[payload]'/>
		<ee:transform doc:name="Prepare response payload" doc:id="72b9f60a-8a74-4eb9-9b8e-81ae265c5a0b" >
			<ee:message >
				<ee:set-payload resource="dwl/updateAccountResponse.dwl"/>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[201]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>
	<sub-flow name="get-account" doc:id="eee0997c-7427-4292-8cdc-ea7fc5882b10" >
		<until-successful maxRetries="${secure::until_successful.max_retries}" millisBetweenRetries="${secure::until_successful.millis_between_retries}" doc:name="Until Successful" doc:id="08ca567d-783a-4df6-8973-d0be99e48aa8" >
			<salesforce:retrieve doc:name="Retrieve Account" doc:id="e797b1c6-dea3-4288-9f77-59b2b02ee15e" config-ref="Salesforce_Config" type="Account" target="responseData" targetValue="#[payload]">
				<salesforce:retrieve-request ><![CDATA[#[output application/java
---
{
	fields: ['Name,AccountNumber,Phone,Fax,BillingStreet,BillingCity,BillingState,BillingPostalCode,BillingCountry,ShippingStreet,ShippingCity,ShippingState,ShippingPostalCode,ShippingCountry'],
	ids: [vars.accountId]
} as Object {
	class : "org.mule.extension.salesforce.api.core.RetrieveRequest"
}]]]></salesforce:retrieve-request>
			</salesforce:retrieve>
		</until-successful>
		<logger level="DEBUG" doc:name="DEBUG : get account response" doc:id="db6d4530-7bea-4386-aed9-dd69022fe115" message='#[payload]'/>
		<ee:transform doc:name="Prepare response payload" doc:id="72b9f60a-8a74-4eb9-9b8e-81ae265c5a0b" >
			<ee:message >
				<ee:set-payload resource="dwl/getAccountResponse.dwl"/>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>
	<sub-flow name="delete-account" doc:id="3e956c02-f292-4d26-aede-fea6f67042c7" >
		<until-successful maxRetries="${secure::until_successful.max_retries}" millisBetweenRetries="${secure::until_successful.millis_between_retries}" doc:name="Until Successful" doc:id="08ca567d-783a-4df6-8973-d0be99e48aa8" >
			<salesforce:delete doc:name="Delete Account" doc:id="ea97702a-7b84-4f9b-b828-927adf3934f0" config-ref="Salesforce_Config" target="responseData" targetValue="#[payload]">
				<salesforce:ids ><![CDATA[#[output application/java
---
[vars.accountId]]]]></salesforce:ids>
			</salesforce:delete>
		</until-successful>
		<logger level="DEBUG" doc:name="DEBUG : delete account response" doc:id="db6d4530-7bea-4386-aed9-dd69022fe115" message='#[payload]'/>
		<ee:transform doc:name="Prepare response payload" doc:id="72b9f60a-8a74-4eb9-9b8e-81ae265c5a0b" >
			<ee:message >
				<ee:set-payload resource="dwl/deleteAccountResponse.dwl"/>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>
</mule>
