<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd 
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="apikit-valid-test-suite.xml" >
		<munit:parameterizations >
			<munit:parameterization name="001" >
				<munit:parameters >
					<munit:parameter propertyName="caseNumber" value="001" />
				</munit:parameters>
			</munit:parameterization>
		</munit:parameterizations>
	</munit:config>
	<munit:test name="【valid】create-accounts" doc:id="d8b8454a-5d00-4640-a978-10eca9dc0448" >
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="mobile-accounts-eapi-main" />
			<munit:enable-flow-source value="post:\accounts:application\json:mobile-accounts-eapi-config" />
      	</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="initiate-create-account" doc:id="96337f1b-17a7-457e-8a32-552797ec3583" processor="flow-ref" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="25df453e-3299-4254-9775-0bcf97edf977" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:variables >
						<munit-tools:variable key="httpStatus" value="#[201]" />
					</munit-tools:variables>
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<ee:transform doc:name="attributes" doc:id="7d94c2bb-b350-430f-8c7e-d43d16a8aef2" >
				<ee:message >
					<ee:set-attributes ><![CDATA[%dw 2.0
output application/java
---
readUrl("classpath://test-data/account/request/valid-req-attributes.json", "application/json") as Object {class: "org.mule.extension.http.api.HttpRequestAttributes"}]]></ee:set-attributes>
				</ee:message>
			</ee:transform>
			<ee:transform doc:name="payload" doc:id="bd155984-fd02-44a4-bcf7-396de6699c4f" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var fileBaseName = "-valid-payload.json"
var caseNumber = Mule::p("caseNumber")
var fileName = caseNumber ++ fileBaseName
---
readUrl("classpath://test-data/account/payload/$(fileName)", "application/json")]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<flow-ref doc:name="mobile-accounts-eapi-main" doc:id="aaac14d4-113c-4c6e-a16e-cada29a97410" name="mobile-accounts-eapi-main" />
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-equals doc:name="HTTP Request" doc:id="0081eaec-97fb-4964-a1f9-04e4f3c03dae" actual="#[vars.httpStatus]" expected='#[201]' />
		</munit:validation>
	</munit:test>
</mule>